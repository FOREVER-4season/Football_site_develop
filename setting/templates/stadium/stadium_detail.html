{%extends 'base.html' %}
{% block content %}
<div class="container-fluid p-0 " style="min-height: 700px">

  <!-- 상단: 경기장 이미지 -->
  <div class="stadium-photo-wrapper my-4">
    <img src="{{ url_for('static', filename=stadium.photo) }}"
         alt="{{ stadium.name }} 사진"
         class="stadium-photo">
  </div>

  <div class="container my-4 position-relative">
    <div class="row">
      <!-- 왼쪽: 매치 정보 -->
      <div class="col-md-7 mb-3">
        <h4 class="fw-bold mb-3">매치 정보</h4>
        <div class="row text-muted">
          <div class="col-6 mb-2">📌 레벨: 모든 레벨</div>
          <div class="col-6 mb-2">👥 성별: 남녀 모두</div>
          <div class="col-6 mb-2">⏱ 경기 시간: 2시간</div>
          <div class="col-6 mb-2">⚽ 방식: 5vs5, 3쿼터</div>
          <div class="col-12 mb-2">정원: {{ capacity }}명 (현재 {{ reserved }}명 신청)</div>
        </div>
      </div>
    </div>

    <!-- 오른쪽 카드 -->
    <div class="match-card-wrapper">
      <div class="border p-3 rounded shadow-sm match-card">
        <p class="mb-1 text-muted">🗓 {{ match.matchtime.start_time.strftime("%Y-%m-%d %H:%M") }} ~
          {{ match.matchtime.end_time.strftime("%H:%M") }}</p>
        <h5 class="fw-bold">{{ match.stadium.name }}</h5>
        <p class="text-muted">📍 위치: {{ match.stadium.location }}</p>
        <p class="mb-1">💰 참가비: <strong>{{ match.stadium.entry_fee }}원</strong></p>
        <p class="mb-1">정원: {{ capacity }}명</p>
        <p class="mb-2">현재 예약: {{ reserved }}명</p>
        <p>
          상태:
          <span class="fw-bold" style="color: {{ 'red' if status == '마감임박' else 'green' }}">
            {{ status }}
          </span>
        </p>

        {% if status == '신청마감' %}
          <button type="button" class="btn mb-2 badge bg-danger w-100 py-2" disabled>모집마감</button>
        {% else %}
          {% if g.user %}
            {% set already_applied = match.user_matches|selectattr("user_id", "equalto", g.user.user_id)|list %}
            {% if already_applied %}
              <!-- ✅ 이미 신청 -->
              <button type="button" class="btn btn-secondary w-100 mb-2" disabled>신청완료</button>
            {% else %}
              <!-- ✅ 신청 가능 -->
                <a href="{{ url_for('order.order', order_id=match.id) }}">
                <button type="submit" class="btn btn-success w-100 mb-2">신청하기</button>
                </a>
            {% endif %}
          {% else %}
            <!-- ✅ 로그인 안 한 경우 -->
            <a href="{{ url_for('auth.login') }}" class="btn btn-secondary w-100 mb-2">로그인 후 신청</a>
          {% endif %}
        {% endif %}

        <a href="{{ url_for('stadium.get_matches') }}" class="btn btn-secondary w-100">목록으로</a>
      </div>
    </div>
  </div>
</div>
{% endblock %}
