{%extends 'base.html' %}
{% block content %}
<div class="container-fluid p-0 " style="min-height: 700px">

  <!-- ìƒë‹¨: ê²½ê¸°ì¥ ì´ë¯¸ì§€ -->
  <div class="stadium-photo-wrapper my-4">
    <img src="{{ url_for('static', filename=stadium.photo) }}"
         alt="{{ stadium.name }} ì‚¬ì§„"
         class="stadium-photo">
  </div>

  <div class="container my-4 position-relative">
    <div class="row">
      <!-- ì™¼ìª½: ë§¤ì¹˜ ì •ë³´ -->
      <div class="col-md-7 mb-3">
        <h4 class="fw-bold mb-3">ë§¤ì¹˜ ì •ë³´</h4>
        <div class="row text-muted">
          <div class="col-6 mb-2">ğŸ“Œ ë ˆë²¨: ëª¨ë“  ë ˆë²¨</div>
          <div class="col-6 mb-2">ğŸ‘¥ ì„±ë³„: ë‚¨ë…€ ëª¨ë‘</div>
          <div class="col-6 mb-2">â± ê²½ê¸° ì‹œê°„: 2ì‹œê°„</div>
          <div class="col-6 mb-2">âš½ ë°©ì‹: 5vs5, 3ì¿¼í„°</div>
          <div class="col-12 mb-2">ì •ì›: {{ capacity }}ëª… (í˜„ì¬ {{ reserved }}ëª… ì‹ ì²­)</div>
        </div>
      </div>
    </div>

    <!-- ì˜¤ë¥¸ìª½ ì¹´ë“œ -->
    <div class="match-card-wrapper">
      <div class="border p-3 rounded shadow-sm match-card">
        <p class="mb-1 text-muted">ğŸ—“ {{ match.matchtime.start_time.strftime("%Y-%m-%d %H:%M") }} ~
          {{ match.matchtime.end_time.strftime("%H:%M") }}</p>
        <h5 class="fw-bold">{{ match.stadium.name }}</h5>
        <p class="text-muted">ğŸ“ ìœ„ì¹˜: {{ match.stadium.location }}</p>
        <p class="mb-1">ğŸ’° ì°¸ê°€ë¹„: <strong>{{ match.stadium.entry_fee }}ì›</strong></p>
        <p class="mb-1">ì •ì›: {{ capacity }}ëª…</p>
        <p class="mb-2">í˜„ì¬ ì˜ˆì•½: {{ reserved }}ëª…</p>
        <p>
          ìƒíƒœ:
          <span class="fw-bold" style="color: {{ 'red' if status == 'ë§ˆê°ì„ë°•' else 'green' }}">
            {{ status }}
          </span>
        </p>

        {% if status == 'ì‹ ì²­ë§ˆê°' %}
          <button type="button" class="btn mb-2 badge bg-danger w-100 py-2" disabled>ëª¨ì§‘ë§ˆê°</button>
        {% else %}
          {% if g.user %}
            {% set already_applied = match.user_matches|selectattr("user_id", "equalto", g.user.user_id)|list %}
            {% if already_applied %}
              <!-- âœ… ì´ë¯¸ ì‹ ì²­ -->
              <button type="button" class="btn btn-secondary w-100 mb-2" disabled>ì‹ ì²­ì™„ë£Œ</button>
            {% else %}
              <!-- âœ… ì‹ ì²­ ê°€ëŠ¥ -->
                <a href="{{ url_for('order.order', order_id=match.id) }}">
                <button type="submit" class="btn btn-success w-100 mb-2">ì‹ ì²­í•˜ê¸°</button>
                </a>
            {% endif %}
          {% else %}
            <!-- âœ… ë¡œê·¸ì¸ ì•ˆ í•œ ê²½ìš° -->
            <a href="{{ url_for('auth.login') }}" class="btn btn-secondary w-100 mb-2">ë¡œê·¸ì¸ í›„ ì‹ ì²­</a>
          {% endif %}
        {% endif %}

        <a href="{{ url_for('stadium.get_matches') }}" class="btn btn-secondary w-100">ëª©ë¡ìœ¼ë¡œ</a>
      </div>
    </div>
  </div>
</div>
{% endblock %}
